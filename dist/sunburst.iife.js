/* sunburst.js v1.1.0 | (c) SunsetWx, LLC. and other contributors | ISC License */
var SunburstJS=(function(){"use strict";const e=["predictions"],t=[];"undefined"!=typeof navigator&&navigator.userAgent&&t.push(navigator.userAgent),"undefined"!=typeof process&&process.versions&&t.push(Object.keys(process.versions).map(e=>`${e}/${process.versions[e]}`).join(" ")),t.push("sunburst.js/1.1.0");const s=t.join(" ");class r extends Error{constructor(e,t){super(e),this.name="RequestError",this.statusCode=t}}var o=e=>btoa(e),n={snakeToCamel:e=>e.replace(/_[a-zA-Z]/g,e=>e.toUpperCase().replace("_","")),camelToSnake:e=>e.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`),convertCaseKeys(e,t){if(Array.isArray(e)){const s=[];for(let r=0;r<e.length;r++)null===e[r]||!Array.isArray(e[r])&&"object"!=typeof e[r]?s[r]=e[r]:s[r]=this.convertCaseKeys(e[r],t);return s}if(e&&"object"==typeof e){const s={};return Object.keys(e).forEach(r=>{const o=t(r);null!==e[r]&&"object"==typeof e[r]?s[o]=this.convertCaseKeys(e[r],t):s[o]=e[r]}),s}return e}};const a=e=>Object.keys(e).map(t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t])).join("&"),c=e=>Array.isArray(e)?e.join(","):"object"==typeof e?e.coordinates.join(","):e,i=e=>(e.geo=c(e.geo),e.after=(e=>e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():e)(e.after),e);var u={params:{quality:Object.freeze({get:i,post:e=>e.map(e=>i(e))}),location:Object.freeze({get:e=>(e.geo=c(e.geo),e)})}},p=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,s){return(function r(o,n){try{var a=t[o](n),c=a.value}catch(e){return void s(e)}if(!a.done)return Promise.resolve(c).then(function(e){r("next",e)},function(e){r("throw",e)});e(c)})("next")})}};return class{constructor(t){const r={clientId:"",clientSecret:"",expiresIn:604800,scope:e,origins:[],addresses:[],token:null,timeout:30,clockSkewOffset:300,userAgent:s,baseUrl:"https://sunburst.sunsetwx.com/v1"};this._state=Object.assign({},r,t)}request(e={},t){var s=this;const{path:o,method:c="GET",headers:i={},qs:u,formData:h,body:d}=e;return new Promise((l=p(function*(p,l){try{t&&(p=t.resolve,l=t.reject);const f={"user-agent":s._state.userAgent};if(!i.authorization){const{accessToken:e}=yield s.getToken({forceRefresh:t});f.authorization=`Bearer ${e}`}const m=yield(({uri:e,timeout:t,method:s="GET",headers:r={},qs:o,formData:n,body:c})=>new Promise((i,u)=>{try{c&&(c=JSON.stringify(c),r["content-type"]="application/json; charset=utf-8"),n&&(c=a(n),r["content-type"]="application/x-www-form-urlencoded; charset=utf-8"),o&&(e=`${e}?${a(o)}`)}catch(e){return u(e)}const p=new XMLHttpRequest;p.open(s,e),Object.keys(r).forEach(e=>p.setRequestHeader(e,r[e])),p.onerror=(()=>{if(p.readyState!==XMLHttpRequest.DONE||0!==p.status)return u(new Error(p.statusText||`unknown request error: ${e}`))}),p.onabort=(()=>u(new Error(`request timeout: ${e}`))),p.onload=(()=>i({response:p.response,statusCode:p.status})),t>0&&setTimeout(()=>p.abort(),1e3*t),p.send(c)}))({method:c,uri:`${s._state.baseUrl}${o}`,headers:Object.assign({},f,i),qs:n.convertCaseKeys(u,n.camelToSnake),formData:n.convertCaseKeys(h,n.camelToSnake),body:n.convertCaseKeys(d,n.camelToSnake),timeout:s._state.timeout}),y=JSON.parse(m.response);return y.error?401!==m.statusCode||t?l(new r(y.error,m.statusCode)):s.request(e,{resolve:p,reject:l}):p(n.convertCaseKeys(y,n.snakeToCamel))}catch(e){try{if("number"!=typeof e.statusCode)return l(e);const{error:t}=JSON.parse(e.message);return l(new r(t||e.message,e.statusCode))}catch(t){return l(e)}}}),function(e,t){return l.apply(this,arguments)}));var l}createSession({email:e,password:t,passcode:s,scope:r,type:n="permanent",params:a={}}){var c,i=this;return new Promise((c=p(function*(c,u){try{const p={grant_type:"password",scope:r.join(" "),type:n,passcode:s},h=o(`${e}:${t}`),{session:d}=yield i.request({method:"POST",path:"/login",headers:{authorization:`Basic ${h}`},formData:Object.assign({},p,a)});return d.scope=d.scope.split(" "),c(d)}catch(e){return u(e)}}),function(e,t){return c.apply(this,arguments)}))}getToken({forceRefresh:e,preventStore:t}){var s,r=this;return new Promise((s=p(function*(s,n){if(!e&&r._state.token&&"object"==typeof r._state.token){const{token:e,clockSkewOffset:t}=r._state,{accessToken:o,expires:n}=e;if(n-1e3*t-(new Date).valueOf()>0)return s({accessToken:o,expires:n})}try{if(!r._state.clientId||!r._state.clientSecret)throw new Error("create a new instance of SunburstJS with both clientId and clientSecret options set");const e=`${r._state.clientId}:${r._state.clientSecret}`,a=o(e),{accessToken:c,expiresIn:i}=yield r.request({method:"POST",path:"/login/session",headers:{authorization:`Basic ${a}`},formData:{grant_type:"client_credentials",expires_in:r._state.expiresIn,scope:r._state.scope.join(" "),origins:r._state.origins.join(" "),addresses:r._state.addresses.join(" ")}}),u=1e3*i+(new Date).valueOf();return t||(r._state.token={accessToken:c,expires:u}),s({accessToken:c,expires:u})}catch(e){return n(e)}}),function(e,t){return s.apply(this,arguments)}))}logout(){var e,t=this;return new Promise((e=p(function*(e,s){try{const r=yield t.request({method:"POST",path:"/logout"});return t._state.token=null,e(r)}catch(e){return s(e)}}),function(t,s){return e.apply(this,arguments)}))}sessions(e={}){return this.request({path:"/account/sessions",qs:e})}deleteSessionById(e={id:""}){return this.request({method:"DELETE",path:`/account/session/${e.id}`,formData:e})}deleteSessions(e={}){return this.request({method:"DELETE",path:"/account/sessions",formData:e})}account(){return this.request({path:"/account"})}deleteAccount(e={}){return this.request({method:"DELETE",path:"/account",formData:e})}passwordReset(e={}){return this.request({method:"POST",path:"/account/password/reset",formData:e})}updateEmail(e={}){return this.request({method:"POST",path:"/account/email",formData:e})}updateMfa(e={}){return this.request({method:"POST",path:"/account/mfa",formData:e})}totpSecret(){return this.request({path:"/account/mfa/totp"})}mfa(){return this.request({path:"/account/mfa"})}coordinates(e={}){return this.request({path:"/coordinates",qs:e})}location(e={}){return this.request({path:"/location",qs:u.params.location.get(e)})}quality(e={}){return this.request({path:"/quality",qs:u.params.quality.get(e)})}batchQuality(e=[]){return this.request({method:"POST",path:"/quality",body:u.params.quality.post(e)})}}})();
